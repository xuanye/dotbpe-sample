(function(c){c.fn.tabpanel=function(f){function i(a,b){b.push("<li id='tab_li_",a.id,"' class='",a.isactive?"x-tab-strip-active":"",a.disabled?"x-tab-strip-disabled":"",a.closeable?" x-tab-strip-closable":"",a.classes?" x-tab-with-icon":"","'>");b.push("<a class='x-tab-strip-close' onclick='return false;'/>");b.push("<a class='x-tab-right' onclick='return false;' href='javascript:void(0)'>");b.push("<em class='x-tab-left'><span class='x-tab-strip-inner'><span class='x-tab-strip-text ",a.classes||
"","'>",a.text,"</span></span></em>");b.push("</a></li>")}function w(a){a.push("<li id='tab_li_closeall' class='x-tab-closeall'>");a.push("<a hideFocus='hideFocus' title='\u5173\u95ed\u6240\u6709' href='javascript:void(0)'>&nbsp;</a>");a.push("</li>")}function x(a,b){b.push("<div class='x-panel x-panel-noborder",a.isactive?"":" x-hide-display","' id='tab_item_",a.id,"' style='width:",innerwidth,"px'>");b.push("<div class='x-panel-bwrap'>");b.push("<div class='x-panel-body x-panel-body-noheader x-panel-body-noborder'  id='tab_item_content_",
a.id,"' style='position:relative;  width:",innerwidth,"px; height:",o,"px; overflow: auto;'>");a.url?(b.push("<iframe name='tab_item_frame_",a.id,"' width='100%' height='100%'  id='tab_item_frame_",a.id,"' src='about:blank' frameBorder='0' />"),b.push("<div id='tab_mask_",a.id,'\' class="x-el-mask"/>'),b.push("<div id='tab_loadingmsg_",a.id,'\' class="x-el-mask-msg x-mask-loading"><div>\u6b63\u5728\u52a0\u8f7d',a.text,"...</div></div>")):a.cuscall?b.push("<div class='loadingicon'/>"):b.push(a.content);
b.push("</div></div></div>")}function y(a){a.id!="tab_li_closeall"&&(B.call(a),C.call(a),D.call(a))}function E(){e.autoscroll&&(g.click(function(){p("left")}),h.click(function(){p("right")}))}function q(){if(e.autoscroll){var a=m.find("li.x-tab-edge").position().left,b=l.scrollLeft();b+a>innerwidth?(n.addClass("x-tab-scrolling"),g.css("visibility","visible"),h.css("visibility","visible"),b>0?g.removeClass("x-tab-scroller-left-disabled"):g.addClass("x-tab-scroller-left-disabled"),a>innerwidth?h.removeClass("x-tab-scroller-right-disabled"):
h.addClass("x-tab-scroller-right-disabled"),e.showscrollnow=!0):(n.removeClass("x-tab-scrolling"),l.animate({scrollLeft:0},"fast"),g.css("visibility","hidden"),h.css("visibility","hidden"),e.showscrollnow=!1)}}function p(a,b){if(e.autoscroll&&e.showscrollnow){var d=l.scrollLeft(),c=m.find("li.x-tab-edge").position().left;if(a=="left"){if(g.hasClass("x-tab-scroller-left-disabled"))return;d-e.scrollwidth-20>0?d-=e.scrollwidth:(d=0,g.addClass("x-tab-scroller-left-disabled"));h.hasClass("x-tab-scroller-right-disabled")&&
h.removeClass("x-tab-scroller-right-disabled")}else{if(h.hasClass("x-tab-scroller-right-disabled")&&!b)return;b||c>innerwidth&&c-e.scrollwidth-20<=innerwidth?(d=d+c-(innerwidth-38),h.addClass("x-tab-scroller-right-disabled")):d+=e.scrollwidth;d>0&&g.hasClass("x-tab-scroller-left-disabled")&&g.removeClass("x-tab-scroller-left-disabled")}l.animate({scrollLeft:d},"fast")}}function B(){c(this).hover(function(){c(this).hasClass("x-tab-strip-disabled")||c(this).addClass("x-tab-strip-over")},function(){c(this).hasClass("x-tab-strip-disabled")||
c(this).removeClass("x-tab-strip-over")})}function D(){c(this).hasClass("x-tab-strip-closable")&&c(this).find("a.x-tab-strip-close").click(function(){var a=c(this).parent().attr("id"),b=a.substr(7);c("#"+a).remove();c("#tab_item_"+b).remove();a:{for(var a=0,d=e.items.length;a<d;a++)if(e.items[a].id==b){b=a;break a}b=-1}if(b>=0){var j;b<e.items.length-1?j=e.items[b+1]:b>0&&(j=e.items[b-1]);j&&c("#tab_li_"+j.id).click();e.items.splice(b,1);e.items.length<e.showcloseall&&(j=c("#tab_li_closeall"),j.length>
0&&j.remove());q();p("right",!0)}})}function F(){if(confirm("\u4f60\u786e\u8ba4\u8981\u5173\u95ed\u6240\u6709\u9009\u9879\u5361\u5417\uff1f")){m.find("li").remove(".x-tab-strip-closable");for(var a=[],b="",d=0,j=e.items.length;d<j;d++)if(!e.items[d].closeable&&(a.push(e.items[d]),!e.items[d].disabled))b=e.items[d].id;e.items=a;b!=""&&c("#tab_li_"+b).click();c("#tab_li_closeall").remove();q();p("right",!0)}}function C(){c(this).click(function(){var a=this.id.substr(7),b=G();if(!(b!=null&&a==b.id)){var d=
s(a);if(!d||!d.disabled){if(b)c("#tab_li_"+b.id).removeClass("x-tab-strip-active"),c("#tab_item_"+b.id).addClass("x-hide-display"),b.isactive=!1;if(d){c(this).addClass("x-tab-strip-active");c("#tab_item_"+d.id).removeClass("x-hide-display");if(d.url){if(frm=document.getElementById("tab_item_frame_"+d.id),frm.src=="about:blank")frm.src=d.url,c.browser.msie?frm.onreadystatechange=function(){if(frm.readyState=="complete")c("#tab_mask_"+d.id).remove(),c("#tab_loadingmsg_"+d.id).remove(),frm.onreadystatechange=
null}:frm.onload=function(){c("#tab_mask_"+d.id).remove();c("#tab_loadingmsg_"+d.id).remove();frm.onload=null},b=c(frm).parent(),a=c("#tab_loadingmsg_"+d.id),b={left:b.width()/2-a.outerWidth()/2,top:b.height()/2-a.outerHeight()/2},a.css(b)}else if(d.cuscall&&!d.cuscalled&&(a=c("#tab_item_content_"+d.id),b=d.cuscall(this,d,a),d.cuscalled=!0,b))d.content=b,a.html(b);d.isactive=!0;d.onactive&&d.onactive.call(this,d)}}}})}function G(){for(var a=0,b=e.items.length;a<b;a++)if(e.items[a].isactive)return e.items[a];
return null}function s(a){for(var b=0,d=e.items.length;b<d;b++)if(e.items[b].id==a)return e.items[b];return null}function z(a){if(s(a.id))alert("\u6307\u5b9a\u7684tab\u9879\u5df2\u5b58\u5728!");else{var b=a.isactive;a.isactive=!1;var d=e.items[e.items.length-1];e.items.push(a);var j=c("#tab_li_"+d.id),d=c("#tab_item_"+d.id),f=[],g=[];i(a,f);x(a,g);f=c(f.join(""));g=c(g.join(""));j.after(f);d.after(g);a=c("#tab_li_"+a.id);y(a);b&&a.click();e.items.length>=e.showcloseall&&c("#tab_li_closeall").length==
0&&(b=[],w(b),a.after(b.join("")),c("#tab_li_closeall").click(F));q();p("right",!0)}}var e={items:[],width:500,height:400,showcloseall:5,scrollwidth:100,autoscroll:!0};c.extend(e,f);var u=c(this).addClass("x-tab-panel").width(e.width);innerwidth=e.width-2;for(var n=c("<div class='x-tab-panel-header x-unselectable "+(e.autoscroll?"x-tab-scrolling-top":"")+"' unselectable='on' style='width:"+innerwidth+"px;MozUserSelect:none;KhtmlUserSelect:none;'></div>"),l=c("<div class='x-tab-strip-wrap'/>"),h=c("<div class='x-tab-scroller-right x-unselectable' style='height: 24px; visibility: hidden; mozuserselect: none; khtmluserselect: none;' unselectable='on'/>"),
g=c("<div class='x-tab-scroller-left x-unselectable' style='height: 24px; visibility: hidden; mozuserselect: none; khtmluserselect: none;' unselectable='on'/>"),m=c("<ul class='x-tab-strip x-tab-strip-top'></ul>"),t=c("<div class='x-tab-strip-spacer'/>"),k=[],f=0,v=e.items.length;f<v;f++){var r=e.items[f];i(r,k)}e.items.length>=e.showcloseall&&w(k);k.push("<li class='x-tab-edge'/><div class='x-clear'></div>");m.html(k.join(""));k=null;l.append(m);e.autoscroll&&n.append(h).append(g);n.append(l).append(t);
for(var o=e.height-29,t=c("<div class='x-tab-panel-bwrap'/>"),A=c("<div class='x-tab-panel-body x-tab-panel-body-top'/>").css({width:innerwidth,height:o}),k=[],f=0,v=e.items.length;f<v;f++)r=e.items[f],x(r,k);A.html(k.join("")).appendTo(t);u.append(n).append(t);(function(){q();E();m.find("li:not(.x-tab-edge)").each(function(){y(this)})})();u[0].tab={addtabitem:z,opentabitem:function(a,b){if(!s(a.id)&&b)z(a);else{var d=c("#tab_li_"+a.id),e=l.scrollLeft(),f=d.position().left,i=d.outerWidth(),k=m.find("li.x-tab-edge").position().left;
f<=0?(e+=f-2,e<0&&(e=0,g.addClass("x-tab-scroller-left-disabled")),h.hasClass("x-tab-scroller-right-disabled")&&h.removeClass("x-tab-scroller-right-disabled"),l.animate({scrollLeft:e},"fast")):f+i>innerwidth-40&&(e=e+f+i+-innerwidth+40,g.hasClass("x-tab-scroller-left-disabled")&&g.removeClass("x-tab-scroller-left-disabled"),k-(f+i+-innerwidth+40)<=innerwidth&&h.addClass("x-tab-scroller-right-disabled"),l.animate({scrollLeft:e},"fast"));d.click();d=c("#tab_item_frame_"+a.id);if(d.length>0&&d[0].src!=
a.url)d[0].src=a.url}},resize:function(a,b){if(!(a==e.width&&b==e.height)){if(a)e.width=a;if(b)e.height=b;innerwidth=a-2;o=e.height-29;u.css("width",e.width);n.css("width",innerwidth);A.css({width:innerwidth,height:o});for(var d=0,f=e.items.length;d<f;d++){var g=e.items[d];c("#tab_item_"+g.id).css({width:innerwidth});c("#tab_item_content_"+g.id).css({width:innerwidth,height:o})}q()}},setdisabletabitem:function(a,b){var d=s(a);if(d&&d.disabled!=b)b?(d.disabled=!0,c("#tab_item_"+r.id).addClass("x-tab-strip-disabled")):
(d.disabled=!1,c("#tab_item_"+r.id).removeClass("x-tab-strip-disabled"))}}};c.fn.addtabitem=function(c){return this[0].tab?this[0].tab.addtabitem(c):!1};c.fn.opentabitem=function(c,i){return this[0].tab?this[0].tab.opentabitem(c,i):!1};c.fn.resizetabpanel=function(c,i){return this[0].tab?this[0].tab.resize(c,i):!1};c.fn.setdisabletabitem=function(c,i){return this[0].tab?this[0].tab.setdisabletabitem(c,i):!1}})(jQuery);
